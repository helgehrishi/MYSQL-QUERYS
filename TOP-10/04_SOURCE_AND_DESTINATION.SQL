-- 04 SOURCE AND DESTINATION
;

-- DROP AND RECREATE THE TABLE
DROP TABLE IF EXISTS SRC_DEST_DISTANCE;

CREATE TABLE SRC_DEST_DISTANCE (
    SOURCE VARCHAR(20),
    DESTINATION VARCHAR(20),
    DISTANCE INT
);

-- INSERT DATA WITH ALL VALUES IN A SINGLE STATEMENT
INSERT INTO
    SRC_DEST_DISTANCE (SOURCE, DESTINATION, DISTANCE)
VALUES
    ('BANGALORE', 'HYDERBAD', 400),
    ('HYDERBAD', 'BANGALORE', 400),
    ('MUMBAI', 'DELHI', 400),
    ('DELHI', 'MUMBAI', 400),
    ('CHENNAI', 'PUNE', 400),
    ('PUNE', 'CHENNAI', 400);

-- SELECT ALL DATA TO VERIFY INSERTION
SELECT
    *
FROM
    SRC_DEST_DISTANCE;

-- FIRST ADD PRIMARY_KEY / UNIQUE IDENTIFIER
SELECT
    *,
    ROW_NUMBER() OVER() AS "ROW_NUM"
FROM
    SRC_DEST_DISTANCE;

-- ADD THIS TO CTE
WITH CTE AS (
    SELECT
        *,
        ROW_NUMBER() OVER() AS "ROW_NUM"
    FROM
        SRC_DEST_DISTANCE
)
SELECT
    *
FROM
    CTE;

-- APPLY SELF JOIN JOIN
WITH CTE AS (
    SELECT
        *,
        ROW_NUMBER() OVER() AS "ROW_NUM"
    FROM
        SRC_DEST_DISTANCE
)
SELECT
    C1.*
FROM
    CTE AS C1
    INNER JOIN CTE AS C2 ON C1.ROW_NUM < C2.ROW_NUM
    AND C1.SOURCE = C2.DESTINATION
    AND C1.DESTINATION = C2.SOURCE;